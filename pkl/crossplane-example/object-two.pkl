amends "@crossplane/Resource.pkl"
import "@crossplane/CompositionRequest.pkl"

import "crds/Object.pkl"
import "@k8s/api/core/v1/ConfigMap.pkl"

local request = import("crossplane:request") as CompositionRequest
local foo: ConfigMap? = request.observed.resources.getOrNull("cm-one")?.resource as ConfigMap?

resource = (Object) {
  metadata {
    name = "cm-two"
  }

  spec {
    forProvider {
      manifest = (ConfigMap) {
        metadata {
          name = "cm-two"
          namespace = "crossplane-system"
        }
        data {
          ["bar"] = foo?.metadata?.name ?? "alternative"
        }
      }.toDynamic()
    }
  }
}
ready = Ready_READY_FALSE
