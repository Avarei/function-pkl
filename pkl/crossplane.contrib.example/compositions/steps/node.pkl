amends "@crossplane.contrib/CompositionResponse.pkl"
import "@crossplane.contrib/crossplane.pkl"

import ".../crds/XR.pkl"
import ".../crds/Object.pkl"

import "@k8s/api/core/v1/ConfigMap.pkl"

local request = new crossplane {
  customResourceTemplates = new {
    ["XR"] {
      ["example.crossplane.io/v1"] = XR
    }
    ["Object"] {
      ["kubernetes.crossplane.io/v1alpha2"] = Object
    }
  }
}.Request

local extraResource: Object? = request.getExtraResource("ineed", 0)?.resource as Object?

requirements {
  extraResources {
    ["ineed"] {
      apiVersion = "v1"
      kind = "Node"
      match {
        matchName = "k3d-crossy-server-0"
      }
    }
  }
}

desired {
  composite {
    resource = new XR {
      status {
        someStatus = "pretty status"
      }
    }
  }
  resources {
    ["cm-one"] = new {
      resource = new Object {
        spec {
          forProvider {
            manifest = new ConfigMap {
              metadata {
                namespace = "crossplane-system"
              }
              data {
                ["required"] = extraResource?.metadata?.name ?? "i could not find what I needed..."
              }
            }
          }
        }
      }
      ready = READY_TRUE
    }
  }
}
