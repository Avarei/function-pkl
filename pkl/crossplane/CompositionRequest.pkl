@ModuleInfo { minPklVersion = "0.25.1" }
module CompositionRequest

import "CrossplaneResource.pkl"

meta: RequestMeta?

context: Mapping<String, Any>?

desired: State?

observed: State?

extraResources: Mapping<String, Resources?>

class RequestMeta {
  tag: String
}

class State {
  composite: CrossplaneResource
  resources: Mapping<String, CrossplaneResource>
}

class Resources {
  items: Listing<CrossplaneResource?>
}

function getExtraResources(name: String): Listing<CrossplaneResource?> =
  extraResources.getOrNull(name).ifNonNull((it: Resources) -> it.items) ?? new Listing<CrossplaneResource?> {}

function getExtraResource(name: String, index: Int):CrossplaneResource? =
    getExtraResources(name).toList().getOrNull(index)
