amends "crResource.pkl"
import "package://pkg.pkl-lang.org/pkl-k8s/k8s@1.0.1#/api/core/v1/ConfigMap.pkl"
import "https://raw.githubusercontent.com/Avarei/function-pkl/main/pkl/CompositionInput.pkl" // TODO replace with package reference

local state = import("crossplane:state") as CompositionInput
local foo: ConfigMap? = state.observed.resources.getOrNull("cm-one")?.resource as ConfigMap?

resource = (ConfigMap) {
  metadata {
    name = "cm-two"
    namespace = "crossplane-system"
  }

  data {
    ["bar"] = "foo?.metadata?.name" ?? "alternative"
  }
}
